<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zhuhuibao.mybatis.memCenter.mapper.MeetingOrderMapper" >
  <resultMap id="BaseResultMap" type="com.zhuhuibao.mybatis.memCenter.entity.MeetingOrder" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="createid" property="createid" jdbcType="VARCHAR" />
    <result column="account" property="account" jdbcType="VARCHAR" />
    <result column="province" property="province" jdbcType="VARCHAR" />
    <result column="city" property="city" jdbcType="VARCHAR" />
    <result column="publishTime" property="publishTime" jdbcType="VARCHAR" />
    <result column="updateTime" property="updateTime" jdbcType="VARCHAR" />
    <result column="updateManId" property="updateManId" jdbcType="VARCHAR" />
    <result column="startDate" property="startDate" jdbcType="VARCHAR" />
    <result column="endDate" property="endDate" jdbcType="VARCHAR" />
    <result column="day" property="day" jdbcType="VARCHAR" />
    <result column="venue" property="venue" jdbcType="VARCHAR" />
    <result column="meetingNum" property="meetingNum" jdbcType="VARCHAR" />
    <result column="meetingType" property="meetingType" jdbcType="VARCHAR" />
    <result column="field" property="field" jdbcType="VARCHAR" />
    <result column="hotel" property="hotel" jdbcType="VARCHAR" />
    <result column="roomSize" property="roomSize" jdbcType="VARCHAR" />
    <result column="roomPrice" property="roomPrice" jdbcType="VARCHAR" />
    <result column="food" property="food" jdbcType="VARCHAR" />
    <result column="mealsNum" property="mealsNum" jdbcType="VARCHAR" />
    <result column="mealsType" property="mealsType" jdbcType="VARCHAR" />
    <result column="mealsPrice" property="mealsPrice" jdbcType="VARCHAR" />
    <result column="priceType" property="priceType" jdbcType="VARCHAR" />
    <result column="present" property="present" jdbcType="VARCHAR" />
    <result column="presentNum" property="presentNum" jdbcType="VARCHAR" />
    <result column="presentPrice" property="presentPrice" jdbcType="VARCHAR" />
    <result column="play" property="play" jdbcType="VARCHAR" />
    <result column="playerNum" property="playerNum" jdbcType="VARCHAR" />
    <result column="playPrice" property="playPrice" jdbcType="VARCHAR" />
    <result column="otherRequriement" property="otherRequriement" jdbcType="VARCHAR" />
    <result column="linkName" property="linkName" jdbcType="VARCHAR" />
    <result column="call" property="call" jdbcType="VARCHAR" />
    <result column="mobile" property="mobile" jdbcType="VARCHAR" />
    <result column="telephone" property="telephone" jdbcType="VARCHAR" />
    <result column="company" property="company" jdbcType="VARCHAR" />
    <result column="email" property="email" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, createid, province, city, publishTime,updateTime,updateManId,startDate, endDate, day, venue, meetingNum, meetingType,
    field, hotel, roomSize, roomPrice, food, mealsNum, mealsType, mealsPrice, priceType, 
    present, presentNum, presentPrice, play, playerNum, playPrice, otherRequriement, 
    linkName, call, mobile, telephone, company, email, status
  </sql>
  <select id="queryMeetingOrderInfoById" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select
    CASE WHEN m.mobile IS NOT NULL and m.mobile != '' THEN m.mobile WHEN m.email IS NOT NULL and m.email != '' THEN m.email END AS account,
    concat(p.name,ci.name)as city,cm.startDate,cm.endDate,a.name as day,b.name as venue,c.name as meetingType,d.name as field,cm.meetingNum,cm.hotel,
    cm.roomSize,cm.roomPrice,cm.food,cm.mealsNum,cm.mealsPrice,e.name as mealsType,f.name as priceType,cm.present,cm.presentNum,cm.presentPrice,cm.play,
    cm.playerNum,cm.playPrice,cm.otherRequriement,cm.linkName,cm.`call`,cm.mobile,cm.telephone,cm.email,cm.company,cm.`status`,u.username as updateManId
    from t_c_meetingOrder cm
    left join t_m_member m on cm.createid = m.id
    left join t_dictionary_province p on cm.province = p.code
    left join t_dictionary_city ci on cm.city = ci.code
    left join t_dictionary_constant a on cm.day = a.code and a.type = 11
    left join t_dictionary_constant b on cm.venue = b.code and b.`type` = 13
    left join t_dictionary_constant c on cm.meetingType = c.code and c.`type` = 12
    left join t_dictionary_constant d on cm.field = d.code and d.`type` = 14
    left join t_dictionary_constant e on cm.mealsType = e.code and e.`type` = 15
    left join t_dictionary_constant f on cm.priceType = f.code and f.`type` = 16
    left join t_oms_user u on u.id = cm.updateManId
    where cm.id = #{id}
  </select>
  <insert id="publishMeetingOrder" parameterType="com.zhuhuibao.mybatis.memCenter.entity.MeetingOrder" >
    insert into t_c_meetingOrder
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="createid != null" >
        createid,
      </if>
      <if test="province != null" >
        province,
      </if>
      <if test="city != null" >
        city,
      </if>
        publishTime,
        updateTime,
      <if test="startDate != null" >
        startDate,
      </if>
      <if test="endDate != null" >
        endDate,
      </if>
      <if test="day != null" >
        day,
      </if>
      <if test="venue != null" >
        venue,
      </if>
      <if test="meetingNum != null" >
        meetingNum,
      </if>
      <if test="meetingType != null" >
        meetingType,
      </if>
      <if test="field != null" >
        field,
      </if>
      <if test="hotel != null" >
        hotel,
      </if>
      <if test="roomSize != null" >
        roomSize,
      </if>
      <if test="roomPrice != null" >
        roomPrice,
      </if>
      <if test="food != null" >
        food,
      </if>
      <if test="mealsNum != null" >
        mealsNum,
      </if>
      <if test="mealsType != null" >
        mealsType,
      </if>
      <if test="mealsPrice != null" >
        mealsPrice,
      </if>
      <if test="priceType != null" >
        priceType,
      </if>
      <if test="present != null" >
        present,
      </if>
      <if test="presentNum != null" >
        presentNum,
      </if>
      <if test="presentPrice != null" >
        presentPrice,
      </if>
      <if test="play != null" >
        play,
      </if>
      <if test="playerNum != null" >
        playerNum,
      </if>
      <if test="playPrice != null" >
        playPrice,
      </if>
      <if test="otherRequriement != null" >
        otherRequriement,
      </if>
      <if test="linkName != null" >
        linkName,
      </if>
      <if test="call != null" >
        call,
      </if>
      <if test="mobile != null" >
        mobile,
      </if>
      <if test="telephone != null" >
        telephone,
      </if>
      <if test="company != null" >
        company,
      </if>
      <if test="email != null" >
        email,
      </if>
      <if test="status != null" >
        status,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id},
      </if>
      <if test="createid != null" >
        #{createid},
      </if>
      <if test="province != null" >
        #{province},
      </if>
      <if test="city != null" >
        #{city},
      </if>
        now(),
        now(),
      <if test="startDate != null" >
        #{startDate},
      </if>
      <if test="endDate != null" >
        #{endDate},
      </if>
      <if test="day != null" >
        #{day},
      </if>
      <if test="venue != null" >
        #{venue},
      </if>
      <if test="meetingNum != null" >
        #{meetingNum},
      </if>
      <if test="meetingType != null" >
        #{meetingType},
      </if>
      <if test="field != null" >
        #{field},
      </if>
      <if test="hotel != null" >
        #{hotel},
      </if>
      <if test="roomSize != null" >
        #{roomSize},
      </if>
      <if test="roomPrice != null" >
        #{roomPrice},
      </if>
      <if test="food != null" >
        #{food},
      </if>
      <if test="mealsNum != null" >
        #{mealsNum},
      </if>
      <if test="mealsType != null" >
        #{mealsType},
      </if>
      <if test="mealsPrice != null" >
        #{mealsPrice},
      </if>
      <if test="priceType != null" >
        #{priceType},
      </if>
      <if test="present != null" >
        #{present},
      </if>
      <if test="presentNum != null" >
        #{presentNum},
      </if>
      <if test="presentPrice != null" >
        #{presentPrice},
      </if>
      <if test="play != null" >
        #{play},
      </if>
      <if test="playerNum != null" >
        #{playerNum},
      </if>
      <if test="playPrice != null" >
        #{playPrice},
      </if>
      <if test="otherRequriement != null" >
        #{otherRequriement},
      </if>
      <if test="linkName != null" >
        #{linkName},
      </if>
      <if test="call != null" >
        #{call},
      </if>
      <if test="mobile != null" >
        #{mobile},
      </if>
      <if test="telephone != null" >
        #{telephone},
      </if>
      <if test="company != null" >
        #{company},
      </if>
      <if test="email != null" >
        #{email},
      </if>
      <if test="status != null" >
        #{status},
      </if>
    </trim>
  </insert>
  <update id="updateMeetingOrderStatus" parameterType="com.zhuhuibao.mybatis.memCenter.entity.MeetingOrder" >
    update t_c_meetingOrder
    <set >
      <if test="status != null" >
        status = #{status},
      </if>
      <if test="updateManId != null" >
        updateManId = #{updateManId},
      </if>
    </set>
    where id = #{id}
  </update>
  <select id="findAllMeetingOrderInfo" resultMap="BaseResultMap" parameterType="java.util.Map" >
    select cm.id,
    CASE WHEN m.mobile IS NOT NULL and m.mobile != '' THEN m.mobile WHEN m.email IS NOT NULL and m.email != '' THEN m.email END AS account,
    concat(p.name,ci.name)as city,cm.publishTime,cm.`status`,cm.updateTime
    from t_c_meetingOrder cm
    left join t_m_member m on cm.createid = m.id
    left join t_dictionary_province p on cm.province = p.code
    left join t_dictionary_city ci on cm.city = ci.code
    where 1=1
    <if test="account != null">
      and (m.email like CONCAT('%',#{account},'%') or m.mobile like CONCAT('%',#{account},'%'))
    </if>
    <if test="province != null">
      and cm.province = #{province}
    </if>
    <if test="city != null">
      and cm.city = #{city}
    </if>
    <if test="status != null">
      and cm.status = #{status}
    </if>
  </select>
</mapper>