<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zhuhuibao.mybatis.oms.mapper.ProjectMapper" >
  <resultMap id="BaseResultMap" type="com.zhuhuibao.mybatis.oms.entity.ProjectInfo" >
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="createid" property="createid" jdbcType="BIGINT" />
    <result column="publishDate" property="publishDate" jdbcType="DATE" />
    <result column="updateDate" property="updateDate" jdbcType="DATE" />
    <result column="province" property="province" jdbcType="VARCHAR" />
    <result column="city" property="city" jdbcType="VARCHAR" />
    <result column="area" property="area" jdbcType="VARCHAR" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="category" property="category" jdbcType="INTEGER" />
    <result column="price" property="price" jdbcType="DOUBLE" />
    <result column="startDate" property="startDate" jdbcType="DATE" />
    <result column="endDate" property="endDate" jdbcType="DATE" />
    <result column="description" property="description" jdbcType="VARCHAR" />
    <result column="record" property="record" jdbcType="VARCHAR" />
    <result column="is_deleted" property="is_deleted" jdbcType="TINYINT" />
  </resultMap>
  
  
   <!-- 添加工程信息@author:gmli@since2016.05.11 -->
  <insert id="addProjectInfo" parameterType="com.zhuhuibao.mybatis.oms.entity.ProjectInfo" >
    insert into t_prj_project
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="name != null" >
        name,
      </if>
      <if test="createid != null" >
        createid,
      </if> 
        publishDate, 
        updateDate, 
      <if test="province != null" >
        province,
      </if>
      <if test="city != null" >
        city,
      </if>
      <if test="area != null" >
        area,
      </if>
      <if test="address != null" >
        address,
      </if>
      <if test="category != null" >
        category,
      </if>
      <if test="price != null" >
        price,
      </if>
      <if test="startDate != null" >
        startDate,
      </if>
      <if test="endDate != null" >
        endDate,
      </if>
      <if test="description != null" >
        description,
      </if>
      <if test="record != null" >
        record,
      </if>
      <if test="is_deleted != null" >
        is_deleted,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="name != null" >
        #{name},
      </if>
      <if test="createid != null" >
        #{createid},
      </if>
      CURDATE(),
      CURDATE(),
      <if test="province != null" >
        #{province},
      </if>
      <if test="city != null" >
        #{city},
      </if>
      <if test="area != null" >
        #{area},
      </if>
      <if test="address != null" >
        #{address},
      </if>
      <if test="category != null" >
        #{category},
      </if>
      <if test="price != null" >
        #{price},
      </if>
      <if test="startDate != null" >
        #{startDate},
      </if>
      <if test="endDate != null" >
        #{endDate},
      </if>
      <if test="description != null" >
        #{description},
      </if>
      <if test="record != null" >
        #{record},
      </if>
       <if test="is_deleted != null" >
        #{is_deleted},
      </if>
      
    </trim>
  </insert>
   <!-- 修改项目工程信息@author:gmli@since2016.05.11 -->
  <update id="updateProjectInfo" parameterType="com.zhuhuibao.mybatis.oms.entity.ProjectInfo" >
    update t_prj_project
    <set > 
      <if test="name != null" >
        name=#{name},
      </if>
    
      <if test="createid != null" >
        createid=#{createid,jdbcType=BIGINT},
      </if>  
        updateDate=now(),
      <if test="province != null" >
        province=#{province},
      </if>
      <if test="city != null" >
        city=#{city},
      </if>
      <if test="area != null" >
        area=#{area},
      </if>
      <if test="address != null" >
        address=#{address},
        
      </if>
      <if test="category != null" >
        category=#{category},
      </if>
      <if test="price != null" >
        price= #{price},
      </if>
      <if test="startDate != null" >
        startDate=#{startDate,jdbcType=DATE},
      </if>
      <if test="endDate != null" >
        endDate=#{endDate,jdbcType=DATE},
      </if>
      <if test="description != null" >
        description=#{description},
      </if>
      <if test="record != null" >
        record=#{record},
      </if>
      <if test="is_deleted != null" >
        is_deleted=#{is_deleted},
      </if>
    </set>
    where id = #{id}
  </update>
  
  
 <select id="queryProjectInfoByID" resultMap="BaseResultMap" parameterType="java.lang.Long" >
	SELECT
	   t.id,t.name,t.createid,t.publishDate,t.updateDate,t.province,t.city,t.area,t.address,t.category,t.price,t.startDate,t.endDate,t.description,t.record,t.is_deleted
	FROM t_prj_project t  
	<where>
      <if test="id != null">
        and t.id = #{id}
      </if>
    </where> 
	 
  </select>

  <select id="findAllPrjectPager" parameterType="java.util.Map" resultType="com.zhuhuibao.mybatis.oms.entity.ProjectInfo">
    SELECT
    t.id,t.name,t.createid,t.publishDate,t.updateDate,concat(pn.name,ct.name,ar.name,t.address) address,
    t.price,t.startDate,t.endDate,t.description,t.record,t.is_deleted,
    (select cs.name from t_dictionary_constant cs where cs.code = t.category and cs.type=8) as categoryName
    FROM t_prj_project t
    left join t_dictionary_province pn on pn.code = t.province
    left join t_dictionary_city ct on ct.code = t.city
    left join t_dictionary_area ar on ar.code = t.area
    <where>
      <if test="name != null and name != ''">
        and t.name like concat('%',#{name},'%')
      </if>
      <if test="category !=null">
        and t.category = #{category}
      </if>
      <if test="province != null and province != ''">
        and t.province = #{province}
      </if>
      <if test="city != null and city != ''">
        and t.city = #{city}
      </if>
    </where>
  </select>

  <select id="queryLatestProject" parameterType="java.util.Map" resultType="com.zhuhuibao.mybatis.oms.entity.ProjectInfo">
    SELECT
    t.id,t.name,t.createid,t.publishDate,t.updateDate
    FROM t_prj_project t
    order by t.updateDate desc
    <if test="count !=null">
      limit #{count}
    </if>
  </select>
</mapper>