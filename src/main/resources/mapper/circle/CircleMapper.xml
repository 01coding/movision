<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.movision.mybatis.circle.mapper.CircleMapper">
    <resultMap id="BaseResultMap" type="com.movision.mybatis.circle.entity.Circle">
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="isofficial" property="isofficial" jdbcType="INTEGER"/>
        <result column="scope" property="scope" jdbcType="INTEGER"/>
        <result column="phone" property="phone" jdbcType="VARCHAR"/>
        <result column="photo" property="photo" jdbcType="VARCHAR"/>
        <result column="category" property="category" jdbcType="INTEGER"/>
        <result column="code" property="code" jdbcType="INTEGER"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="introduction" property="introduction" jdbcType="VARCHAR"/>
        <result column="notice" property="notice" jdbcType="VARCHAR"/>
        <result column="permission" property="permission" jdbcType="INTEGER"/>
        <result column="isrecommend" property="isrecommend" jdbcType="INTEGER"/>
        <result column="maylikeimg" property="maylikeimg" jdbcType="TIMESTAMP"/>
        <result column="createtime" property="createtime" jdbcType="TIMESTAMP"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
        <result column="supportnum" property="supportnum" jdbcType="INTEGER"/>
        <result column="isdiscover" property="isdiscover" jdbcType="INTEGER"/>
        <result column="orderid" property="orderid" jdbcType="INTEGER"/>
    </resultMap>
    <sql id="Base_Column_List">
        id, isofficial, scope, phone, photo, category, code, name, introduction, notice,
        permission, isrecommend, maylikeimg, createtime, status, supportnum, isdiscover, orderid
    </sql>

    <!--基础查询语句-->
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        select
        <include refid="Base_Column_List"/>
        from yw_circle
        where id = #{id,jdbcType=INTEGER}
    </select>

    <!-- 根据圈子id查询手机号 -->
    <select id="queryCircleByPhone" parameterType="java.lang.Integer" resultType="String">
        SELECT c.phone
        FROM yw_circle c
        WHERE c.id=#{id,jdbcType=INTEGER}
    </select>

    <!--查询发现页中列出的圈子-->
    <select id="queryHotCircleList" resultType="com.movision.mybatis.circle.entity.CircleVo">
        SELECT t1.id,t1.photo,t1.category,t1.code,t1.name,t1.introduction,t1.isdiscover
        FROM yw_circle t1 WHERE t1.isdiscover = '1' AND t1.status = '1'
        ORDER BY orderid
    </select>

    <!--根据圈子id查询圈子详情-->
    <select id="queryCircleIndex1" parameterType="java.lang.Integer"
            resultType="com.movision.mybatis.circle.entity.CircleVo">
        SELECT id,isofficial,scope,phone,photo,category,code,name,introduction,notice,permission,createtime,status,supportnum
        FROM yw_circle WHERE id = #{circleid,jdbcType=INTEGER}
    </select>

    <!--按照分类id查询圈子列表-->
    <select id="queryCircleByCategory" parameterType="java.lang.Integer"
            resultType="com.movision.mybatis.circle.entity.CircleVo">
        SELECT id,name,photo FROM yw_circle
        WHERE category = #{categoryid,jdbcType=INTEGER}
          AND status = '1'
    </select>

    <!--查询所有待审核的圈子-->
    <select id="queryAuditCircle" resultType="com.movision.mybatis.circle.entity.CircleVo">
        SELECT id,name,photo,supportnum FROM yw_circle
        WHERE status = '0'
    </select>

    <!--查询当前圈子的开放范围scope-->
    <select id="queryCircleScope" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        SELECT scope FROM yw_circle WHERE id = #{circleid,jdbcType=INTEGER}
    </select>

    <!--查询当前圈子所有者userid-->
    <select id="queryCircleOwner" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        SELECT id FROM yw_user WHERE phone = (
        SELECT phone FROM yw_circle WHERE id = #{circleid,jdbcType=INTEGER}
        )
    </select>

    <!--查询帖子详情最下方推荐的4个热门圈子-->
    <select id="queryHotCircle" resultType="com.movision.mybatis.circle.entity.Circle">
        SELECT t1.id,t1.name,t1.maylikeimg
        FROM yw_circle t1 WHERE t1.isdiscover = '1' AND t1.status = '1'
        ORDER BY orderid
        LIMIT 4;
    </select>

    <!--查询圈子的信息（包括公告和简介等）-->
    <select id="queryCircleInfo" parameterType="java.lang.Integer"
            resultType="com.movision.mybatis.circle.entity.CircleVo">
        SELECT * FROM (
        SELECT t1.id, t1.phone, t1.category, t1.code, t1.introduction, t1.notice, t1.createtime, t1.status,
        t1.supportnum, t2.categoryname
        FROM yw_circle t1
        LEFT JOIN yw_circle_category t2
        ON t1.category = t2.id) t
        WHERE t.id = #{circleid,jdbcType=INTEGER}
    </select>

    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from yw_circle
    where id = #{id,jdbcType=INTEGER}
  </delete>
    <insert id="insert" parameterType="com.movision.mybatis.circle.entity.Circle">
    insert into yw_circle (id, isofficial, scope, 
      phone, photo, category, 
      code, name, introduction, 
      notice, permission, isrecommend, maylikeimg,
        createtime, status, supportnum, isdiscover,
      orderid)
    values (#{id,jdbcType=INTEGER}, #{isofficial,jdbcType=INTEGER}, #{scope,jdbcType=INTEGER}, 
      #{phone,jdbcType=VARCHAR}, #{photo,jdbcType=VARCHAR}, #{category,jdbcType=INTEGER}, 
      #{code,jdbcType=INTEGER}, #{name,jdbcType=VARCHAR}, #{introduction,jdbcType=VARCHAR}, 
      #{notice,jdbcType=VARCHAR}, #{permission,jdbcType=INTEGER}, #{isrecommend,jdbcType=INTEGER}, #{maylikeimg,jdbcType=INTEGER},
        #{createtime,jdbcType=TIMESTAMP}, #{status,jdbcType=INTEGER}, #{supportnum,jdbcType=INTEGER},
        #{isdiscover,jdbcType=INTEGER},
      #{orderid,jdbcType=INTEGER})
  </insert>
    <insert id="insertSelective" parameterType="com.movision.mybatis.circle.entity.Circle">
        insert into yw_circle
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="isofficial != null">
                isofficial,
            </if>
            <if test="scope != null">
                scope,
            </if>
            <if test="phone != null">
                phone,
            </if>
            <if test="photo != null">
                photo,
            </if>
            <if test="category != null">
                category,
            </if>
            <if test="code != null">
                code,
            </if>
            <if test="name != null">
                name,
            </if>
            <if test="introduction != null">
                introduction,
            </if>
            <if test="notice != null">
                notice,
            </if>
            <if test="permission != null">
                permission,
            </if>
            <if test="isrecommend != null">
                isrecommend,
            </if>
            <if test="maylikeimg != null">
                maylikeimg,
            </if>
            <if test="createtime != null">
                createtime,
            </if>
            <if test="status != null">
                status,
            </if>
            <if test="supportnum != null">
                supportnum,
            </if>
            <if test="isdiscover != null">
                isdiscover,
            </if>
            <if test="orderid != null">
                orderid,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="isofficial != null">
                #{isofficial,jdbcType=INTEGER},
            </if>
            <if test="scope != null">
                #{scope,jdbcType=INTEGER},
            </if>
            <if test="phone != null">
                #{phone,jdbcType=VARCHAR},
            </if>
            <if test="photo != null">
                #{photo,jdbcType=VARCHAR},
            </if>
            <if test="category != null">
                #{category,jdbcType=INTEGER},
            </if>
            <if test="code != null">
                #{code,jdbcType=INTEGER},
            </if>
            <if test="name != null">
                #{name,jdbcType=VARCHAR},
            </if>
            <if test="introduction != null">
                #{introduction,jdbcType=VARCHAR},
            </if>
            <if test="notice != null">
                #{notice,jdbcType=VARCHAR},
            </if>
            <if test="permission != null">
                #{permission,jdbcType=INTEGER},
            </if>
            <if test="isrecommend != null">
                #{isrecommend,jdbcType=INTEGER},
            </if>
            <if test="maylikeimg != null">
                #{maylikeimg,jdbcType=INTEGER},
            </if>
            <if test="createtime != null">
                #{createtime,jdbcType=TIMESTAMP},
            </if>
            <if test="status != null">
                #{status,jdbcType=INTEGER},
            </if>
            <if test="supportnum != null">
                #{supportnum,jdbcType=INTEGER},
            </if>
            <if test="isdiscover != null">
                #{isdiscover,jdbcType=INTEGER},
            </if>
            <if test="orderid != null">
                #{orderid,jdbcType=INTEGER},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.movision.mybatis.circle.entity.Circle">
        update yw_circle
        <set>
            <if test="isofficial != null">
                isofficial = #{isofficial,jdbcType=INTEGER},
            </if>
            <if test="scope != null">
                scope = #{scope,jdbcType=INTEGER},
            </if>
            <if test="phone != null">
                phone = #{phone,jdbcType=VARCHAR},
            </if>
            <if test="photo != null">
                photo = #{photo,jdbcType=VARCHAR},
            </if>
            <if test="category != null">
                category = #{category,jdbcType=INTEGER},
            </if>
            <if test="code != null">
                code = #{code,jdbcType=INTEGER},
            </if>
            <if test="name != null">
                name = #{name,jdbcType=VARCHAR},
            </if>
            <if test="introduction != null">
                introduction = #{introduction,jdbcType=VARCHAR},
            </if>
            <if test="notice != null">
                notice = #{notice,jdbcType=VARCHAR},
            </if>
            <if test="permission != null">
                permission = #{permission,jdbcType=INTEGER},
            </if>
            <if test="isrecommend != null">
                isrecommend = #{isrecommend,jdbcType=INTEGER},
            </if>
            <if test="maylikeimg != null">
                maylikeimg = #{maylikeimg,jdbcType=INTEGER},
            </if>
            <if test="createtime != null">
                createtime = #{createtime,jdbcType=TIMESTAMP},
            </if>
            <if test="status != null">
                status = #{status,jdbcType=INTEGER},
            </if>
            <if test="supportnum != null">
                supportnum = #{supportnum,jdbcType=INTEGER},
            </if>
            <if test="isdiscover != null">
                isdiscover = #{isdiscover,jdbcType=INTEGER},
            </if>
            <if test="orderid != null">
                orderid = #{orderid,jdbcType=INTEGER},
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.movision.mybatis.circle.entity.Circle">
    update yw_circle
    set isofficial = #{isofficial,jdbcType=INTEGER},
      scope = #{scope,jdbcType=INTEGER},
      phone = #{phone,jdbcType=VARCHAR},
      photo = #{photo,jdbcType=VARCHAR},
      category = #{category,jdbcType=INTEGER},
      code = #{code,jdbcType=INTEGER},
      name = #{name,jdbcType=VARCHAR},
      introduction = #{introduction,jdbcType=VARCHAR},
      notice = #{notice,jdbcType=VARCHAR},
      permission = #{permission,jdbcType=INTEGER},
      isrecommend = #{isrecommend,jdbcType=INTEGER},
      maylikeimg = #{maylikeimg,jdbcType=INTEGER},
      createtime = #{createtime,jdbcType=TIMESTAMP},
        status = #{status,jdbcType=INTEGER},
      supportnum = #{supportnum,jdbcType=INTEGER},
      isdiscover = #{isdiscover,jdbcType=INTEGER},
      orderid = #{orderid,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
</mapper>