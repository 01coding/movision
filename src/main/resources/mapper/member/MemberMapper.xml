<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zhuhuibao.mybatis.memCenter.mapper.MemberMapper">
    <resultMap id="BaseResultMap" type="com.zhuhuibao.mybatis.memCenter.entity.Member">
        <id column="id" property="id" jdbcType="VARCHAR"/>
        <result column="mobile" property="mobile" jdbcType="VARCHAR"/>
        <result column="email" property="email" jdbcType="VARCHAR"/>
        <result column="emailCheckCode" property="emailCheckCode" jdbcType="VARCHAR"/>
        <result column="password" property="password" jdbcType="VARCHAR"/>
        <result column="registerTime" property="registerTime" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
        <result column="identify" property="identify" jdbcType="VARCHAR"/>
        <result column="identifyName" property="identifyName" jdbcType="VARCHAR"/>
        <result column="enterpriseName" property="enterpriseName" jdbcType="VARCHAR"/>
        <result column="workType" property="workType" jdbcType="VARCHAR"/>
        <result column="workTypeName" property="workTypeName" jdbcType="VARCHAR"/>
        <result column="enterpriseEmployeeParentId" property="enterpriseEmployeeParentId" jdbcType="VARCHAR"/>
        <result column="province" property="province" jdbcType="VARCHAR"/>
        <result column="provinceName" property="provinceName" jdbcType="VARCHAR"/>
        <result column="city" property="city" jdbcType="VARCHAR"/>
        <result column="cityName" property="cityName" jdbcType="VARCHAR"/>
        <result column="area" property="area" jdbcType="VARCHAR"/>
        <result column="areaName" property="areaName" jdbcType="VARCHAR"/>
        <result column="address" property="address" jdbcType="VARCHAR"/>
        <result column="enterpriseType" property="enterpriseType" jdbcType="VARCHAR"/>
        <result column="enterpriseTypeName" property="enterpriseTypeName" jdbcType="VARCHAR"/>
        <result column="enterpriseLogo" property="enterpriseLogo" jdbcType="VARCHAR"/>
        <result column="enterpriseDesc" property="enterpriseDesc" jdbcType="VARCHAR"/>
        <result column="headShot" property="headShot" jdbcType="VARCHAR"/>
        <result column="saleProductDesc" property="saleProductDesc" jdbcType="VARCHAR"/>
        <result column="enterpriseCreaterTime" property="enterpriseCreaterTime" jdbcType="VARCHAR"/>
        <result column="registerCapital" property="registerCapital" jdbcType="VARCHAR"/>
        <result column="currency" property="currency" jdbcType="VARCHAR"/>
        <result column="employeeNumber" property="employeeNumber" jdbcType="VARCHAR"/>
        <result column="employeeNumberName" property="employeeNumberName" jdbcType="VARCHAR"/>
        <result column="coBusLicNum" property="coBusLicNum" jdbcType="VARCHAR"/>
        <result column="companyBusinessLicenseImg" property="companyBusinessLicenseImg" jdbcType="VARCHAR"/>
        <result column="enterpriseProvince" property="enterpriseProvince" jdbcType="VARCHAR"/>
        <result column="enterpriseProvinceName" property="enterpriseProvinceName" jdbcType="VARCHAR"/>
        <result column="enterpriseCity" property="enterpriseCity" jdbcType="VARCHAR"/>
        <result column="enterpriseCityName" property="enterpriseCityName" jdbcType="VARCHAR"/>
        <result column="enterpriseArea" property="enterpriseArea" jdbcType="VARCHAR"/>
        <result column="enterpriseAreaName" property="enterpriseAreaName" jdbcType="VARCHAR"/>
        <result column="enterpriseAddress" property="enterpriseAddress" jdbcType="VARCHAR"/>
        <result column="enterpriseTelephone" property="enterpriseTelephone" jdbcType="VARCHAR"/>
        <result column="enterpriseFox" property="enterpriseFox" jdbcType="VARCHAR"/>
        <result column="enterpriseWebSite" property="enterpriseWebSite" jdbcType="VARCHAR"/>
        <result column="enterpriseLinkman" property="enterpriseLinkman" jdbcType="VARCHAR"/>
        <result column="enterpriseLMDep" property="enterpriseLMDep" jdbcType="VARCHAR"/>
        <result column="fixedTelephone" property="fixedTelephone" jdbcType="VARCHAR"/>
        <result column="fixedMobile" property="fixedMobile" jdbcType="VARCHAR"/>
        <result column="QQ" property="QQ" jdbcType="VARCHAR"/>
        <result column="nickname" property="nickname" jdbcType="VARCHAR"/>
        <result column="personRealName" property="personRealName" jdbcType="VARCHAR"/>
        <result column="sex" property="sex" jdbcType="VARCHAR"/>
        <result column="personCompanyType" property="personCompanyType" jdbcType="VARCHAR"/>
        <result column="personIdentifyCard" property="personIdentifyCard" jdbcType="VARCHAR"/>
        <result column="personIDFrontImgUrl" property="personIDFrontImgUrl" jdbcType="VARCHAR"/>
        <result column="personIDBackImgUrl" property="personIDBackImgUrl" jdbcType="VARCHAR"/>
        <result column="isrecommend" property="isrecommend" jdbcType="VARCHAR"/>
        <result column="reason" property="reason" jdbcType="VARCHAR"/>
    </resultMap>
    <resultMap id="ResultMap" type="com.zhuhuibao.common.pojo.AccountBean">
        <result column="id" property="id" jdbcType="VARCHAR"/>
        <result column="account" property="account" jdbcType="VARCHAR"/>
        <result column="enterpriseName" property="enterpriseName" jdbcType="VARCHAR"/>
    </resultMap>
    <resultMap id="ResultMap1" type="com.zhuhuibao.common.pojo.ResultBean">
        <result column="id" property="code" jdbcType="VARCHAR"/>
        <result column="enterpriseName" property="name" jdbcType="VARCHAR"/>
        <result column="enterpriseLogo" property="smallIcon" jdbcType="VARCHAR"/>
    </resultMap>
    <resultMap id="ResultMap2" type="com.zhuhuibao.common.pojo.OmsMemBean">
        <result column="id" property="id" jdbcType="VARCHAR"/>
        <result column="registerTime" property="registerTime" jdbcType="VARCHAR"/>
        <result column="account" property="account" jdbcType="VARCHAR"/>
        <result column="enterpriseLinkman" property="enterpriseLinkman" jdbcType="VARCHAR"/>
        <result column="memberName" property="memberName" jdbcType="VARCHAR"/>
        <result column="memberType" property="memberType" jdbcType="VARCHAR"/>
        <result column="workType" property="workType" jdbcType="VARCHAR"/>
        <result column="identify" property="identify" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="VARCHAR"/>
        <result column="isrecommend" property="isrecommend" jdbcType="VARCHAR"/>
        <result column="certificate_name" property="certificate_name" jdbcType="VARCHAR"/>
        <result column="certificate_grade" property="certificate_grade" jdbcType="VARCHAR"/>
        <result column="certificate_number" property="certificate_number" jdbcType="VARCHAR"/>
        <result column="certificate_url" property="certificate_url" jdbcType="VARCHAR"/>
        <result column="publishTime" property="publishTime" jdbcType="VARCHAR"/>
        <result column="time" property="time" jdbcType="VARCHAR"/>
    </resultMap>
    <sql id="Base_Column_List">
        id, mobile, email, emailCheckCode, password, registerTime, status, identify,
        enterpriseName, workType, enterpriseEmployeeParentId, province,
        city, area, address, enterpriseType, enterpriseLogo, enterpriseDesc, headShot, saleProductDesc,
        enterpriseCreaterTime, registerCapital, currency, employeeNumber, coBusLicNum, companyBusinessLicenseImg,
        enterpriseProvince, enterpriseCity, enterpriseArea, enterpriseAddress,
        enterpriseTelephone, enterpriseFox, enterpriseWebSite, enterpriseLinkman, enterpriseLMDep,
        fixedTelephone, fixedMobile, QQ, personRealName, nickname, sex, personCompanyType,
        personIdentifyCard, personIDFrontImgUrl, personIDBackImgUrl, isrecommend
    </sql>
    <select id="findMemById" resultType="com.zhuhuibao.mybatis.memCenter.entity.Member">
        SELECT
            m.id,
            m.mobile,
            m.email,
            m.emailCheckCode,
            m.password,
            date_format(m.registerTime, '%Y-%m-%d %H:%i:%s') registerTime,
            m.status,
            m.identify,
            m.enterpriseName,
            m.workType,
            m.enterpriseEmployeeParentId,
            m.province,
            m.city,
            m.area,
            m.address,
            m.enterpriseType,
            m.enterpriseLogo,
            m.enterpriseDesc,
            m.headShot,
            m.saleProductDesc,
            date_format(m.enterpriseCreaterTime, '%Y-%m-%d') enterpriseCreaterTime,
            m.registerCapital,
            m.currency,
            m.employeeNumber,
            m.coBusLicNum,
            m.companyBusinessLicenseImg,
            m.enterpriseProvince,
            m.enterpriseCity,
            m.enterpriseArea,
            m.enterpriseAddress,
            m.enterpriseTelephone,
            m.enterpriseFox,
            m.enterpriseWebSite,
            m.enterpriseLinkman,
            m.enterpriseLMDep,
            m.fixedTelephone,
            m.fixedMobile,
            m.QQ,
            m.personRealName,
            m.nickname,
            m.sex,
            m.personCompanyType,
            m.personIdentifyCard,
            m.personIDFrontImgUrl,
            m.personIDBackImgUrl,
            m.isrecommend,
            m.reason,
            p1.name                                          provinceName,
            p2.name                                          enterpriseProvinceName,
            c1.name                                          cityName,
            c2.name                                          enterpriseCityName,
            a1.name                                          areaName,
            a2.name                                          enterpriseAreaName,
            e.name                                           employeeNumberName,
            et.name                                          enterpriseTypeName,
            w.name                                           workTypeName,
            (SELECT group_concat(name)
             FROM t_dictionary_identity
             WHERE find_in_set(id, m.identify))          AS  identifyName,
            (SELECT group_concat(name)
             FROM t_dictionary_identity
             WHERE find_in_set(id, m.personCompanyType)) AS  personCompanyTypeName,
             v.vip_level vipLevel
        FROM t_m_member m
            LEFT JOIN t_dictionary_province p1 ON m.province = p1.code
            LEFT JOIN t_dictionary_province p2 ON m.enterpriseProvince = p2.code
            LEFT JOIN t_dictionary_city c1 ON m.city = c1.code
            LEFT JOIN t_dictionary_city c2 ON m.enterpriseCity = c2.code
            LEFT JOIN t_dictionary_area a1 ON m.area = a1.code
            LEFT JOIN t_dictionary_area a2 ON m.enterpriseArea = a2.code
            LEFT JOIN t_dictionary_employeeSize e ON m.employeeNumber = e.id
            LEFT JOIN t_dictionary_enterpriseType et ON m.enterpriseType = et.id
            LEFT JOIN t_dictionary_workType w ON m.workType = w.id
            LEFT JOIN t_vip_member_info v ON v.member_id = m.id
        WHERE m.id = #{id}
    </select>

    <insert id="addMember" parameterType="com.zhuhuibao.mybatis.memCenter.entity.Member" useGeneratedKeys="true"
            keyProperty="id">
        insert into t_m_member
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="mobile != null">
                mobile,
            </if>
            <if test="email != null">
                email,
            </if>
            <if test="password != null">
                password,
            </if>
            <if test="registerTime != null">
                registerTime,
            </if>
            <if test="status != null">
                status,
            </if>
            <if test="identify != null">
                identify,
            </if>
            <if test="enterpriseName != null">
                enterpriseName,
            </if>
            <if test="workType != null">
                workType,
            </if>
            <if test="enterpriseEmployeeParentId != null">
                enterpriseEmployeeParentId,
            </if>
            <if test="province != null">
                province,
            </if>
            <if test="city != null">
                city,
            </if>
            <if test="area != null">
                area,
            </if>
            <if test="address != null">
                address,
            </if>
            <if test="enterpriseType != null">
                enterpriseType,
            </if>
            <if test="enterpriseLogo != null">
                enterpriseLogo,
            </if>
            <if test="enterpriseDesc != null">
                enterpriseDesc,
            </if>
            <if test="headShot != null">
                headShot,
            </if>
            <if test="saleProductDesc != null">
                saleProductDesc,
            </if>
            <if test="enterpriseCreaterTime != null">
                enterpriseCreaterTime,
            </if>
            <if test="registerCapital != null">
                registerCapital,
            </if>
            <if test="currency != null">
                currency,
            </if>
            <if test="employeeNumber != null">
                employeeNumber,
            </if>
            <if test="coBusLicNum != null">
                coBusLicNum,
            </if>
            <if test="companyBusinessLicenseImg != null">
                companyBusinessLicenseImg,
            </if>
            <if test="enterpriseProvince != null">
                enterpriseProvince,
            </if>
            <if test="enterpriseCity != null">
                enterpriseCity,
            </if>
            <if test="enterpriseArea != null">
                enterpriseArea,
            </if>
            <if test="enterpriseAddress != null">
                enterpriseAddress,
            </if>
            <if test="enterpriseTelephone != null">
                enterpriseTelephone,
            </if>
            <if test="enterpriseFox != null">
                enterpriseFox,
            </if>
            <if test="enterpriseWebSite != null">
                enterpriseWebSite,
            </if>
            <if test="enterpriseLinkman != null">
                enterpriseLinkman,
            </if>
            <if test="enterpriseLMDep != null">
                enterpriseLMDep,
            </if>
            <if test="fixedTelephone != null">
                fixedTelephone,
            </if>
            <if test="fixedMobile != null">
                fixedMobile,
            </if>
            <if test="QQ != null">
                QQ,
            </if>
            <if test="personRealName != null">
                personRealName,
            </if>
            <if test="nickname != null">
                nickname,
            </if>
            <if test="sex != null">
                sex,
            </if>
            <if test="personCompanyType != null">
                personCompanyType,
            </if>
            <if test="personIdentifyCard != null">
                personIdentifyCard,
            </if>
            <if test="personIDFrontImgUrl != null">
                personIDFrontImgUrl,
            </if>
            <if test="personIDBackImgUrl != null">
                personIDBackImgUrl,
            </if>
            <if test="isrecommend != null">
                isrecommend,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="mobile != null">
                #{mobile},
            </if>
            <if test="email != null">
                #{email},
            </if>
            <if test="password != null">
                #{password},
            </if>
            <if test="registerTime != null">
                now(),
            </if>
            <if test="status != null">
                #{status},
            </if>
            <if test="identify != null">
                #{identify},
            </if>
            <if test="enterpriseName != null">
                #{enterpriseName},
            </if>
            <if test="workType != null">
                #{workType},
            </if>
            <if test="enterpriseEmployeeParentId != null">
                #{enterpriseEmployeeParentId},
            </if>
            <if test="province != null">
                #{province},
            </if>
            <if test="city != null">
                #{city},
            </if>
            <if test="area != null">
                #{area},
            </if>
            <if test="address != null">
                #{address},
            </if>
            <if test="enterpriseType != null">
                #{enterpriseType},
            </if>
            <if test="enterpriseLogo != null">
                #{enterpriseLogo},
            </if>
            <if test="enterpriseDesc != null">
                #{enterpriseDesc},
            </if>
            <if test="headShot != null">
                #{headShot},
            </if>
            <if test="saleProductDesc != null">
                #{saleProductDesc},
            </if>
            <if test="enterpriseCreaterTime != null">
                #{enterpriseCreaterTime},
            </if>
            <if test="registerCapital != null">
                #{registerCapital},
            </if>
            <if test="currency != null">
                #{currency},
            </if>
            <if test="employeeNumber != null">
                #{employeeNumber},
            </if>
            <if test="coBusLicNum != null">
                #{coBusLicNum},
            </if>
            <if test="companyBusinessLicenseImg != null">
                #{companyBusinessLicenseImg},
            </if>
            <if test="enterpriseProvince != null">
                #{enterpriseProvince},
            </if>
            <if test="enterpriseCity != null">
                #{enterpriseCity},
            </if>
            <if test="enterpriseArea != null">
                #{enterpriseArea},
            </if>
            <if test="enterpriseAddress != null">
                #{enterpriseAddress},
            </if>
            <if test="enterpriseTelephone != null">
                #{enterpriseTelephone},
            </if>
            <if test="enterpriseFox != null">
                #{enterpriseFox},
            </if>
            <if test="enterpriseWebSite != null">
                #{enterpriseWebSite},
            </if>
            <if test="enterpriseLinkman != null">
                #{enterpriseLinkman},
            </if>
            <if test="enterpriseLMDep != null">
                #{enterpriseLMDep},
            </if>
            <if test="fixedTelephone != null">
                #{fixedTelephone},
            </if>
            <if test="fixedMobile != null">
                #{fixedMobile},
            </if>
            <if test="QQ != null">
                #{QQ},
            </if>
            <if test="personRealName != null">
                #{personRealName},
            </if>
            <if test="nickname != null">
                #{nickname},
            </if>
            <if test="sex != null">
                #{sex},
            </if>
            <if test="personCompanyType != null">
                #{personCompanyType},
            </if>
            <if test="personIdentifyCard != null">
                #{personIdentifyCard},
            </if>
            <if test="personIDFrontImgUrl != null">
                #{personIDFrontImgUrl},
            </if>
            <if test="personIDBackImgUrl != null">
                #{personIDBackImgUrl},
            </if>
            <if test="isrecommend != null">
                #{isrecommend},
            </if>
        </trim>
    </insert>
    <select id="findAllByPager" resultMap="BaseResultMap">
        select
        *
        from t_m_member
        where
        enterpriseEmployeeParentId = #{enterpriseEmployeeParentId} and status!=2
        <if test="account != null and account != '' ">
            and (email like CONCAT('%',#{account},'%') or mobile like CONCAT('%',#{account},'%'))
        </if>
    </select>
    <select id="findStaffByParentId" resultMap="BaseResultMap">
        select
        *
        from t_m_member
        where
        enterpriseEmployeeParentId = #{enterpriseEmployeeParentId} and status=1
        <if test="account != null and account != '' ">
            and (email like CONCAT('%',#{account},'%') or mobile like CONCAT('%',#{account},'%'))
        </if>
    </select>
    <select id="findMember" parameterType="com.zhuhuibao.mybatis.memCenter.entity.Member" resultMap="BaseResultMap">
        select
        *
        from t_m_member
        where status != 2 and status != 0
        <if test="mobile != null and mobile != '' ">
            and mobile = #{mobile}
        </if>
        <if test="email != null and email != '' ">
            and email = #{email}
        </if>
    </select>
    <select id="findAgentMember" resultMap="ResultMap">
        select
        id,
        CASE WHEN mobile IS NOT NULL and mobile != '' THEN mobile WHEN email IS NOT NULL and email != '' THEN email END
        AS account,
        enterpriseName
        from t_m_member
        where
        identify like '%4%' and status not in (0,2) AND
        <if test="type == 1">
            (email like CONCAT('%',#{account},'%') or mobile like CONCAT('%',#{account},'%'))
        </if>
        <if test="type == 2">
            enterpriseName like CONCAT('%',#{account},'%')
        </if>
    </select>
    <insert id="agentRegister" keyProperty="id" parameterType="com.zhuhuibao.mybatis.memCenter.entity.Member"
            useGeneratedKeys="true">
        INSERT INTO t_m_member (email, password, registerTime, status, identify) VALUES
            (#{email},#{password},now(),1,4)
    </insert>
    <select id="findNewEngineerOrSupplier" resultMap="BaseResultMap">
        select * FROM t_m_member WHERE
        status in(6,9,10,11) and
        <if test="type==1">
            identify like '%3%'
        </if>
        <if test="type == 2">
            identify like '%4%'
        </if>
        <if test="type == 3">
            identify like '%5%'
        </if>
        <if test="type == 4">
            identify like '%6%'
        </if>
        and enterpriseLogo is not null
        order by registerTime desc
        <if test="type==1">
            limit 0,2
        </if>
        <if test="type == 2">
            limit 0,2
        </if>
        <if test="type == 3">
            limit 0,2
        </if>
        <if test="type == 4">
            limit 0,6
        </if>
    </select>
    <select id="findnewIdentifyEngineer" resultMap="BaseResultMap">
        select * FROM t_m_member WHERE
        status = 5 and
        <if test="type==1">
            identify like '%3%'
        </if>
        <if test="type == 2">
            identify like '%4%'
        </if>
        <if test="type == 3">
            identify like '%5%'
        </if>
        <if test="type == 4">
            identify like '%6%'
        </if>
        order by registerTime desc
    </select>
    <select id="findGreatCompany" resultMap="ResultMap1">
        SELECT id,enterpriseName,enterpriseLogo FROM t_m_member
        where isrecommend = 1 and status in(6,9,10,11) AND
        <if test="type==1">
            identify like '%3%'
        </if>
        <if test="type == 2">
            identify like '%4%'
        </if>
        <if test="type == 3">
            identify like '%5%'
        </if>
        <if test="type == 4">
            identify like '%6%'
        </if>
    </select>

    <select id="findAllMemberByPager" resultMap="ResultMap2" parameterType="com.zhuhuibao.common.pojo.OmsMemBean">
        select m.id,date_format(m.registerTime,'%Y-%m-%d %H:%i:%s') registerTime,m.isrecommend,
        CASE WHEN m.mobile IS NOT NULL and m.mobile != '' THEN m.mobile WHEN m.email IS NOT NULL and m.email != '' THEN m.email END AS account,
        m.enterpriseLinkman,
        CASE WHEN m.enterpriseName IS NOT NULL and m.enterpriseName != '' THEN m.enterpriseName
        WHEN m.personRealName IS NOT NULL and m.personRealName != '' THEN m.personRealName END AS memberName,
        CASE WHEN m.identify = 2 THEN '个人会员' WHEN m.identify != 2 then '企业会员' END AS memberType,
        CASE WHEN m.workType = 100 then '管理员' when m.workType!=100 then w.name end as worktype,
        (select group_concat(name) from t_dictionary_identity where find_in_set(id,m.identify))as identify,
        m.status
        from t_m_member m
        left join t_dictionary_workType w on m.workType = w.id
        WHERE 1=1
        <if test="account != null and account != '' ">
            and (m.email like CONCAT('%',#{account},'%') or m.mobile like CONCAT('%',#{account},'%'))
        </if>
        <if test="memberName != null and memberName != '' ">
            and (m.enterpriseName like CONCAT('%',#{memberName},'%') or m.personRealName like CONCAT('%',#{memberName},'%'))
        </if>
        <if test="memberType != null and memberType == 2 ">
            and m.identify = 2
        </if>
        <if test="memberType != null and memberType == 1 ">
            and m.identify != 2
        </if>
        <if test="identify != null and identify != '' ">
            and find_in_set(#{identify},m.identify)
        </if>
        <if test="status != null and status != '' ">
            and m.status = #{status}
        </if>
        <if test="type != null and type == 1">
            and m.status in (9,10,11)
        </if>
        <if test="type != null and type == 2">
            and m.status in (5,6,7)
        </if>
    </select>

    <select id="findAllInfocheckMemberByPager" resultType="java.util.Map" parameterType="com.zhuhuibao.common.pojo.OmsMemBean">
        SELECT ic.id ,
        CASE WHEN ic.mobile IS NOT NULL AND ic.mobile != '' THEN ic.mobile WHEN ic.email IS NOT NULL AND ic.email != ''
        THEN ic.email END AS account ,
        date_format(ic.updateTime,'%Y-%m-%d %H:%i:%s') AS registerTime ,
        CASE WHEN ic.enterpriseName IS NOT NULL AND ic.enterpriseName != '' THEN ic.enterpriseName WHEN
        rc.personRealName IS NOT NULL AND rc.personRealName != '' THEN rc.personRealName END AS memberName ,
        ic.enterpriseLinkman ,
        CASE WHEN ic.identify = 2 THEN '个人会员' WHEN ic.identify != 2 then '企业会员' END AS memberType ,
        CASE WHEN ic.workType = 100 then '管理员' when ic.workType != 100 then w. name end as worktype ,
        (select group_concat(name) from t_dictionary_identity where find_in_set(id , ic.identify)) as identify ,
        ic. STATUS AS infoStatus ,
        rc. STATUS AS realStatus
        FROM t_m_member_info_check ic
        LEFT JOIN t_dictionary_workType w ON ic.workType = w.id
        LEFT JOIN t_m_member_real_check rc ON ic.id = rc.id
        WHERE  ic.status in (5,6,7)
            <if test="account != null and account != '' ">
                and (ic.email like CONCAT('%',#{account},'%') or ic.mobile like CONCAT('%',#{account},'%'))
            </if>
            <if test="memberName != null and memberName != '' ">
                and (ic.enterpriseName like CONCAT('%',#{memberName},'%')
                    or rc.personRealName like CONCAT('%',#{memberName},'%'))
            </if>
            <if test="memberType != null and memberType == 2 ">
                and ic.identify = 2
            </if>
            <if test="memberType != null and memberType == 1 ">
                and ic.identify != 2
            </if>
            <if test="identify != null and identify != '' ">
                and find_in_set(#{identify},m.identify)
            </if>
            <if test="status != null and status != ''" >
                and ic.status = #{status}
            </if>
        order by ic.updateTime desc
    </select>

    <select id="findAllRealcheckMemberByPager" resultType="java.util.Map" parameterType="com.zhuhuibao.common.pojo.OmsMemBean">
        SELECT ic.id ,
        CASE WHEN ic.mobile IS NOT NULL AND ic.mobile != '' THEN ic.mobile WHEN ic.email IS NOT NULL AND ic.email != ''
        THEN ic.email END AS account ,
        date_format(ic.updateTime,'%Y-%m-%d %H:%i:%s') AS registerTime ,
        CASE WHEN ic.enterpriseName IS NOT NULL AND ic.enterpriseName != '' THEN ic.enterpriseName WHEN
        rc.personRealName IS NOT NULL AND rc.personRealName != '' THEN rc.personRealName END AS memberName ,
        ic.enterpriseLinkman ,
        CASE WHEN ic.identify = 2 THEN '个人会员' WHEN ic.identify != 2 then '企业会员' END AS memberType ,
        CASE WHEN ic.workType = 100 then '管理员' when ic.workType != 100 then w. name end as worktype ,
        (select group_concat(name) from t_dictionary_identity where find_in_set(id , ic.identify)) as identify ,
        ic. STATUS AS infoStatus ,
        rc. STATUS AS realStatus
        FROM t_m_member_info_check ic
        LEFT JOIN t_dictionary_workType w ON ic.workType = w.id
        LEFT JOIN t_m_member_real_check rc ON ic.id = rc.id
       WHERE  rc.status in (9,10,11)
            <if test="account != null and account != '' ">
                and (ic.email like CONCAT('%',#{account},'%') or ic.mobile like CONCAT('%',#{account},'%'))
            </if>
            <if test="memberName != null and memberName != '' ">
                and (ic.enterpriseName like CONCAT('%',#{memberName},'%')
                    or rc.personRealName like CONCAT('%',#{memberName},'%'))
            </if>
            <if test="memberType != null and memberType == 2 ">
                and ic.identify = 2
            </if>
            <if test="memberType != null and memberType == 1 ">
                and ic.identify != 2
            </if>
            <if test="identify != null and identify != '' ">
                and find_in_set(#{identify},m.identify)
            </if>
            <if test="status != null and status != ''" >
                and rc.status = #{status}
            </if>
        order by rc.updateTime desc
    </select>

    <select id="findAllMemCertificateByPager" resultMap="ResultMap2"
            parameterType="com.zhuhuibao.common.pojo.OmsMemBean">
        select r.certificate_name,r.certificate_grade,date_format(r.time,'%Y-%m-%d %H:%i:%s')
        time,r.status,r.id,r.certificate_url,r.certificate_number,
        CASE WHEN m.enterpriseName IS NOT NULL and m.enterpriseName != '' THEN m.enterpriseName
        WHEN m.personRealName IS NOT NULL and m.personRealName != '' THEN m.personRealName END AS memberName,
        CASE WHEN m.identify = 2 THEN '个人会员' WHEN m.identify != 2 then '企业会员' END AS memberType,
        CASE WHEN m.mobile IS NOT NULL and m.mobile != '' THEN m.mobile WHEN m.email IS NOT NULL and m.email != '' THEN
        m.email END AS account
        from t_certificate_record r
        left join t_m_member m on m.id = r.mem_id
        WHERE 1=1
        <if test="account != null and account != '' ">
            and (m.email like CONCAT('%',#{account},'%') or m.mobile like CONCAT('%',#{account},'%'))
        </if>
        <if test="memberName != null and memberName != '' ">
            and (m.enterpriseName like CONCAT('%',#{memberName},'%') or m.personRealName like
            CONCAT('%',#{memberName},'%'))
        </if>
        <if test="memberType != null and memberType == 2 ">
            and m.identify = 2
        </if>
        <if test="memberType != null and memberType == 1 ">
            and m.identify != 2
        </if>
        <if test="status != null and status != '' ">
            and r.status = #{status}
        </if>
        <if test="id != null and id != '' ">
            and r.id = #{id}
        </if>
    </select>
    <update id="updateMemInfo" parameterType="com.zhuhuibao.mybatis.memCenter.entity.Member">
        update t_m_member
        <set>
            <if test="mobile != null">
                mobile = #{mobile},
            </if>
            <if test="email != null">
                email = #{email},
            </if>
            <if test="emailCheckCode != null">
                emailCheckCode = #{emailCheckCode},
            </if>
            <if test="password != null">
                password = #{password},
            </if>
            <if test="registerTime != null">
                registerTime = #{registerTime},
            </if>
            <if test="status != null">
                status = #{status},
            </if>
            <if test="identify != null">
                identify = #{identify},
            </if>
            <if test="enterpriseName != null">
                enterpriseName = #{enterpriseName},
            </if>
            <if test="workType != null">
                workType = #{workType},
            </if>
            <if test="enterpriseEmployeeParentId != null">
                enterpriseEmployeeParentId = #{enterpriseEmployeeParentId},
            </if>
            <if test="province != null">
                province = #{province},
            </if>
            <if test="city != null">
                city = #{city},
            </if>
            <if test="area != null">
                area = #{area},
            </if>
            <if test="address != null">
                address = #{address},
            </if>
            <if test="enterpriseType != null">
                enterpriseType = #{enterpriseType},
            </if>
            <if test="enterpriseLogo != null">
                enterpriseLogo = #{enterpriseLogo},
            </if>
            <if test="enterpriseDesc != null">
                enterpriseDesc = #{enterpriseDesc},
            </if>
            <if test="headShot != null">
                headShot = #{headShot},
            </if>
            <if test="saleProductDesc != null">
                saleProductDesc = #{saleProductDesc},
            </if>
            <if test="enterpriseCreaterTime != null">
                enterpriseCreaterTime = #{enterpriseCreaterTime},
            </if>
            <if test="registerCapital != null">
                registerCapital = #{registerCapital},
            </if>
            <if test="currency != null">
                currency = #{currency},
            </if>
            <if test="employeeNumber != null">
                employeeNumber = #{employeeNumber},
            </if>
            <if test="coBusLicNum != null">
                coBusLicNum = #{coBusLicNum},
            </if>
            <if test="companyBusinessLicenseImg != null">
                companyBusinessLicenseImg = #{companyBusinessLicenseImg},
            </if>
            <if test="enterpriseProvince != null">
                enterpriseProvince = #{enterpriseProvince},
            </if>
            <if test="enterpriseCity != null">
                enterpriseCity = #{enterpriseCity},
            </if>
            <if test="enterpriseArea != null">
                enterpriseArea = #{enterpriseArea},
            </if>
            <if test="enterpriseAddress != null">
                enterpriseAddress = #{enterpriseAddress},
            </if>
            <if test="enterpriseTelephone != null">
                enterpriseTelephone = #{enterpriseTelephone},
            </if>

            <if test="enterpriseFox != null">
                enterpriseFox = #{enterpriseFox},
            </if>
            <if test="enterpriseWebSite != null">
                enterpriseWebSite = #{enterpriseWebSite},
            </if>
            <if test="enterpriseLinkman != null">
                enterpriseLinkman = #{enterpriseLinkman},
            </if>
            <if test="enterpriseLMDep != null">
                enterpriseLMDep = #{enterpriseLMDep},
            </if>
            <if test="fixedTelephone != null">
                fixedTelephone = #{fixedTelephone},
            </if>
            <if test="fixedMobile != null">
                fixedMobile = #{fixedMobile},
            </if>
            <if test="QQ != null">
                QQ = #{QQ},
            </if>
            <if test="personRealName != null">
                personRealName = #{personRealName},
            </if>
            <if test="nickname != null">
                nickname = #{nickname},
            </if>
            <if test="sex != null">
                sex = #{sex},
            </if>
            <if test="personCompanyType != null">
                personCompanyType = #{personCompanyType},
            </if>
            <if test="personIdentifyCard != null">
                personIdentifyCard = #{personIdentifyCard},
            </if>
            <if test="personIDFrontImgUrl != null">
                personIDFrontImgUrl = #{personIDFrontImgUrl},
            </if>
            <if test="personIDBackImgUrl != null">
                personIDBackImgUrl = #{personIDBackImgUrl},
            </if>
            <if test="isrecommend != null">
                isrecommend = #{isrecommend},
            </if>
            <if test="reason != null">
                reason = #{reason},
            </if>
        </set>
        where id = #{id}
    </update>

    <update id="updateSubMemInfo" parameterType="com.zhuhuibao.mybatis.memCenter.entity.Member">
        UPDATE t_m_member
        SET status = #{status} where enterpriseEmployeeParentId = #{id}
    </update>

    <select id="queryCompanyByKeywords" resultType="java.util.Map" parameterType="java.lang.String">
        SELECT
            id,
            enterpriseName
        FROM t_m_member
        WHERE enterpriseName LIKE CONCAT('%',#{keywords},'%') and status !=2 and identify !=2
    </select>

    <select id="queryCompanyList" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
            ad.connectedId AS id,
            ad.imgUrl      AS enterpriseLogo
        FROM t_sys_advertising ad
            LEFT JOIN t_sys_adv_attr at ON at.id = ad.advAttrId
        WHERE at.chanType = #{chanType}
              AND at.page = #{page}
              AND at.advArea = #{advArea}
        order by ad.sort   asc
    </select>

    <select id="queryGreatCompany" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
            ad.connectedId AS id,
            ad.imgUrl      AS enterpriseLogo,
            m.enterpriseName,
            m.enterpriseWebSite,
            m.enterpriseDesc
        FROM t_sys_advertising ad
            LEFT JOIN t_sys_adv_attr at ON at.id = ad.advAttrId
            LEFT JOIN t_m_member m ON m.id = ad.connectedId
        WHERE at.chanType = #{chanType}
              AND at.page = #{page}
              AND at.advArea = #{advArea}
        order by ad.sort   asc
    </select>

    <select id="findMemberOms" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT m.id from t_m_member m
        left join t_vip_member_info vm on m.id = vm.member_id
        <where>
            <if test="accounts !=null and account !=''">
                and (find_in_set(m.mobile,#{accounts}) or find_in_set(m.email,#{accounts}))
            </if>
            <if test="memberType !=null and memberType == 1">
                and m.identify != 2
            </if>
            <if test="memberType !=null and memberType == 2">
                and m.identify = 2
            </if>
            <if test="identify !=null and identify != ''">
                and m.identify like CONCAT('%',#{identify},'%')
            </if>
            <if test="level !=null and level !=''">
                and vm.vip_level = #{level}
            </if>
        </where>
    </select>

    <select id="queryEngineerList" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
            ad.connectedId      AS id,
            ad.imgUrl           AS logo,
            m.enterpriseName    AS companyName,
            m.enterpriseWebSite AS webSite,
            m.saleProductDesc,
            m.address,
            v.vip_level
        FROM t_sys_advertising ad
            LEFT JOIN t_sys_adv_attr at ON at.id = ad.advAttrId
            LEFT JOIN t_m_member m ON m.id = ad.connectedId
            left join t_vip_member_info v on v.member_id=ad.connectedId
        WHERE at.chanType = #{chanType}
              AND at.page = #{page}
              AND at.advArea = #{advArea}
        order by ad.sort   asc
    </select>
</mapper>
